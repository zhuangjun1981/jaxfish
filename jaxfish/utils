import h5py
import numpy as np
import numbers
from typing import Union


def save_h5_dataset(
    h5_group: h5py.Group,
    key: str,
    value: Union[int, float, list, tuple, np.ndarray],
):
    if isinstance(value, Union[list, tuple]):
        value = np.array(value)

    if key == "food_pos_history":
        dset = h5_group.create_dataset(
            key, data=value, dtype=np.uint8, compression="lzf"
        )
    elif key == "terrain_map":
        dset = h5_group.create_dataset(key, data=value, dtype=np.uint8)
    elif key == "position_history":
        dset = h5_group.create_dataset(
            key, data=value, dtype=np.uint16, compression="lzf"
        )
    elif key == "rf_positions":
        dset = h5_group.create_dataset(key, data=value, dtype=np.int32)
    elif key == "step_motion":
        dset = h5_group.create_dataset(key, data=value, dtype=np.int16)
    elif isinstance(value, numbers.Integral):
        dset = h5_group.create_dataset(key, data=value, dtype=np.int32)
    elif isinstance(value, float):
        dset = h5_group.create_dataset(key, data=value, dtype=np.float32)
    elif isinstance(value, np.ndarray):
        if np.issubdtype(value.dtype, np.integer):
            dset = h5_group.create_dataset(key, data=value, dtype=np.uint16)
        elif np.issubdtype(value.dtype, np.floating):
            dset = h5_group.create_dataset(key, data=value, dtype=np.float32)
    else:
        dset = h5_group.create_dataset(key, data=value)

    return dset